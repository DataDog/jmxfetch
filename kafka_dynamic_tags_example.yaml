# Example Kafka JMX configuration with dynamic tags
# This demonstrates how to automatically tag all metrics with values from JMX bean attributes

instances:
  - host: kafka-broker-1
    port: 9999
    tags:
      # Static tags
      - env:production
      - service:kafka
      
      # Dynamic tag: Extract the Kafka cluster ID from the ClusterId MBean
      # Syntax: tag_name:$bean_name#AttributeName
      - cluster_id:$kafka.server:type=KafkaServer,name=ClusterId#Value
      
      # You can also use the 'attribute.' prefix for clarity
      - cluster_id:$kafka.server:type=KafkaServer,name=ClusterId#attribute.Value
      
      # More examples of dynamic tags:
      # - kafka_version:$kafka.server:type=app-info,id=1#Version
      # - broker_id:$kafka.server:type=KafkaServer,name=BrokerId#Value
    
    conf:
      # Your normal JMX metric configuration
      - include:
          domain: kafka.server
          bean_regex:
            - kafka.server:type=BrokerTopicMetrics,name=.*
          attribute:
            Count:
              metric_type: rate
              alias: kafka.broker.topic.count
      
      - include:
          domain: kafka.network
          bean: kafka.network:type=RequestMetrics,name=RequestsPerSec,request=Produce
          attribute:
            Count:
              metric_type: rate
              alias: kafka.network.produce.requests


