init_config:

instances:
    -   process_name_regex: .*surefire.*
        name: jmx_config_dynamic_tags_caching_test
        conf:
            # Config 1: Uses cluster_id
            - include:
               domain: org.datadog.jmxfetch.test
               type: DynamicTagTestApp
               dynamic_tags:
                   cluster_id:
                       bean: org.datadog.jmxfetch.test:type=DynamicTagTestApp
                       attribute: ClusterId
               attribute:
                    Metric:
                        metric_type: gauge
                        alias: test.metric1
            
            # Config 2: Uses same cluster_id (should be cached)
            - include:
               domain: org.datadog.jmxfetch.test
               type: DynamicTagTestApp
               dynamic_tags:
                   cluster_id:
                       bean: org.datadog.jmxfetch.test:type=DynamicTagTestApp
                       attribute: ClusterId
               attribute:
                    Port:
                        metric_type: gauge
                        alias: test.metric2


