version: 2
lint_steps: &lint_steps
  steps:
    - checkout
    - run: mvn verify -B -Dhttps.protocols=TLSv1.2 -DskipTests -Dlog4j.configuration=log4j2.travis.properties
build_steps: &build_steps
  steps:
    - checkout
    - run: mvn test -B -Dhttps.protocols=TLSv1.2 -Dcheckstyle.skip=true -Dlog4j.configurationFile=log4j2.travis.properties -Dtests.log_level=info
    - run:
        when: on_fail
        command: for log in target/surefire-reports/*.txt; do  echo "$log ========================" ; cat $log ; done

jobs:
  lint_openjdk8:
    docker:
      - image: circleci/openjdk:8-jdk
    <<: *lint_steps
  test_openjdk8:
    docker:
      - image: circleci/openjdk:8-jdk
    <<: *build_steps
  test_openjdk11:
    docker:
      - image: circleci/openjdk:11-jdk
    <<: *build_steps
  test_openjdk15:
    docker:
      - image: circleci/openjdk:15-jdk-buster
    <<: *build_steps
  test_openjdk17:
    docker:
      - image: circleci/openjdk:17-jdk-buster
    <<: *build_steps
  test_openjdk18:
    docker:
      - image: circleci/openjdk:18-jdk-buster
    <<: *build_steps

workflows:
  version: 2
  workflow:
    jobs:
      - lint_openjdk8
      - test_openjdk8
      - test_openjdk11
      - test_openjdk15
      - test_openjdk17
      - test_openjdk18
